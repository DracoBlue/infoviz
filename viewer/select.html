<?xml version="1.0" encoding="UTF-8"?>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Select</title>
        <script type="text/javascript" src="lib/protovis-3.2/protovis-r3.2.js">
        </script>
        <script type="text/javascript" src="lib/mootools-1.2.3.js">
        </script>
        <script type="text/javascript" src="lib/mootools-1.2.4.2-more.js">
        </script>
        <script type="text/javascript" src="lib/vendor/cattle_ui.js">
        </script>
        <script type="text/javascript" src="lib/project.js">
        </script>
        <script type="text/javascript" src="lib/AttributePreviewImageElement.js">
        </script>
        <script type="text/javascript" src="lib/AttributeDatabase.js">
        </script>
        <script type="text/javascript" src="lib/AttributeSelector.js">
        </script>
        <script type="text/javascript" src="lib/Graph.js">
        </script>
        <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/themes/ui-lightness/jquery-ui.css" type="text/css" media="all" />
        <link rel="stylesheet" href="lib/screen.css" type="text/css" media="all" />
    </head>
    <body>
        <div id="center">
            <div id="first_selector" class="ui-helper-clearfix" style="overflow-x: hidden; overflow-y: scroll; height: 150px;">
            </div>
            <div id="graph" class="ui-helper-clearfix" style="width:625px; height:325px;">
            </div>
            <div id="second_selector" class="ui-helper-clearfix" style="overflow-x: hidden; overflow-y: scroll; height: 150px;">
            </div>
        </div>
        <div id="center2">
        <div id="graph2">
        </div>
        <div id="controls" class="ui-widget ui-widget-content" style="padding: 10px">
        </div>
        <div id="slider">
        </div>
        <div id="slider2" style="display:none">
            <div class="ui-state-disabled ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all">
                <div class="ui-slider-range ui-widget-header" style="left: 28%; width: 49%;">
                </div>
                <a href="#" class="ui-slider-handle ui-state-default ui-corner-all" style="left: 28%;"></a>
                <a href="#" class="ui-slider-handle ui-state-default ui-corner-all" style="left: 77%;"></a>
            </div>
        </div>
        <script type="text/javascript">
            $(window).addEvent('domready', function(){
                var attribute_database = new project.AttributeDatabase();
                
                var refresh_graph_trigger = function(){
                    var first_attribute_name = first_attribute_selector.getSelectedAttributeName();
                    var second_attribute_name = 'C';
                    
                    try {
                        second_attribute_name = second_attribute_selector.getSelectedAttributeName();
                    } 
                    catch (e) {
                    }
                    
                    
                    $('graph').grab(graph);
                    
                    new Request.JSON({
                        'url': 'data/' + first_attribute_name + '_' + second_attribute_name + '.json',
                        'onSuccess': function(response){
                            console.log(response);
                            graph.refresh(response);
                        },
                        'onFailure': function() {
                            alert('Datei ' + 'data/' + first_attribute_name + '_' + second_attribute_name + '.json' + ' not found!');
                        }
                    }).get();
                };
                
                var first_attribute_selector = new project.AttributeSelector(attribute_database, {
                    'image_url_generator_function': function(attribute_name){
                        return 'preview/' + attribute_name + '.png';
                    },
                    'events': {
                        'select': function(){
                            second_attribute_selector.regenerateUrls();
                            $('second_selector').grab(second_attribute_selector);
                            refresh_graph_trigger();
                        }
                    }
                });
                
                var second_attribute_selector = new project.AttributeSelector(attribute_database, {
                    'image_url_generator_function': function(attribute_name){
                        var first_attribute_name = null;
                        
                        try {
                            first_attribute_name = first_attribute_selector.getSelectedAttributeName();
                        } 
                        catch (e) {
                        }
                        
                        return 'preview/' + attribute_name + '.png';
//                        return first_attribute_name + '_' + attribute_name + '.png';
                    },
                    'events': {
                        'select': function(){
                            refresh_graph_trigger();
                        }
                    }
                });
                
                var graph = new project.Graph({});
                
                //                $('graph').grab(graph);
                
                cattle_ui.ui('header', {
                    'text': 'Erstes Attribute'
                }).toElement().inject($('first_selector'), 'before');
                $('first_selector').adopt(first_attribute_selector);
                
                cattle_ui.ui('header', {
                    'text': 'Graph'
                }).toElement().inject($('graph'), 'before');
                
                cattle_ui.ui('header', {
                    'text': 'Zweites Attribute'
                }).toElement().inject($('second_selector'), 'before');
            });
        </script>
    </body>
</html>
